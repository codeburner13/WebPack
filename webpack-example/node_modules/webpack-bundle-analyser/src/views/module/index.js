import { setTitle } from 'meta';
import { mapModulesUid } from 'format-data';

import {
  hideModuleGraph,
  setActiveModule,
  showModuleGraph,
} from 'graphs/modules';

export default async (render, options) => {
  const id = Number.parseInt(options.args[1], 10);
  const m = mapModulesUid[id];

  setTitle(`Module ${m.id}`);

  const template = await import('./view.jade');
  render(template.default, {
    id,
    issuer: mapModulesUid[m.issuerUid],
    module: m,
  });

  setTimeout(() => {
    showModuleGraph();
    setActiveModule(id);
  }, 0);

  options.registerMethod('componentWillUnmount', () => hideModuleGraph());
};
