import { setTitle } from 'meta';

import {
  hideModuleGraph,
  setNormal,
  showModuleGraph,
} from 'graphs/modules';

export default async (render, options) => {
  setTitle('Modules');

  const template = await import('./view.jade');
  render(template.default);

  let sort;
  const attachListeners = () => {
    const [button] = document.getElementsByClassName('js-sort-size');
    if (button) {
      button.addEventListener('click', () => {
        // First sort will be desc.
        sort = sort === 'asc' ? 'desc' : 'asc';
        options.stats.modules.sort((a, b) => sort === 'asc' ? b.size - a.size : a.size - b.size); // eslint-disable-line no-confusing-arrow
        render(template.default);
        attachListeners();
      });
    }
  };

  attachListeners();

  setTimeout(() => {
    showModuleGraph();
    setNormal();
  }, 0);

  options.registerMethod('componentWillUnmount', () => hideModuleGraph());
};
